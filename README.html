<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<title>pymacros4py</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="pymacros4py">
<h1 class="title">pymacros4py</h1>

<div class="section" id="brief-description">
<h1>Brief description</h1>
<p>pymacros4py is a templating system for Python code. It is based on a source-level macro
preprocessor. Expressions, statements, and functions in the macro domain are also
written in Python.</p>
</div>
<div class="section" id="why-and-when">
<h1>Why and when?</h1>
<p>Typical Python software is developed without using macros. And that for good reasons:
Macros are not necessary. And they have serious disadvantages.</p>
<p>But in some cases, you might want to write code that generates or manipulates
code. Then, using a template system might be a good alternative.</p>
<p>Here are some examples:</p>
<ul class="simple">
<li>You maintain a common code base for two different platforms, e.g., CPython and
Cython. There are places in your code where you want to differentiate
between the platforms already on the source level, e.g., in order to hide code
for one platform from users of the other platform.</li>
<li>There is this function that is called in performance critical code, and you
want to inline it - but without spreading its implementation all over the project, and
without larger modifications of your project, e.g., like switching to PyPy.</li>
<li>You need to automatically generate parts of the content of some
configuration file, and you want to make this process more explicit than using some
generator script hidden somewhere in your project.</li>
</ul>
<p>You need a templating system for Python code? Welcome to pymacros4py!</p>
<p>(Note: pymacros4py expands macros at the source-level. For extending
the language Python itself, in order to get a programming language with
additional capabilities, macro expansion
on the level of the abstract syntax tree, in the build phase of the
interpretation process, is better suited. See, e.g., the language lab
<a class="reference external" href="https://pypi.org/project/mcpyrate/">mcpyrate</a>.)</p>
</div>
<div class="section" id="properties">
<h1>Properties</h1>
<p><em>pymacros4py</em> is a templating system with the following characteristics:</p>
<ul class="simple">
<li>It is <strong>made for templates for Python files</strong>, e.g., macro-generated code
respects indentation.</li>
<li><strong>Statements, functions, and expressions of the macro domain</strong>
<strong>are defined as Python code</strong> -
You do not need to learn a special macro language.
And you can directly use all the capabilities of Python.</li>
<li>The preprocessor works <strong>on the source level</strong> - You see the resulting code before
any bytecode generation / compilation / interpretation is done. And no dependency on
external code, libraries or executables is introduced in these execution phases.</li>
<li>Macro variables and functions
<strong>can be defined directly in the files where they are used</strong>, or
in separate files.</li>
<li>Macro expansion can be <strong>multi-level</strong>, e.g., when macro code includes templates
that contain macro code. Expansion results are cached in order to avoid unnecessary
computations.</li>
<li><strong>No replacements outside explicitly marked macro sections take place</strong> -
This avoids the problem that a macro definition may automatically apply to future
code added by other maintainers who do not know about the macro, with unexpected
results.</li>
</ul>
<p><em>pymacros4py</em> is implemented as <strong>pure Python code, with a really tiny code base</strong>.
It could be an acceptable pre-build dependency for your project, even if you aim at
avoiding dependencies. And if it is not acceptable, just copy its code directly into
your project.</p>
<p>The code of <em>pymacros4py</em> is tested with 100% code coverage.
All examples in this README, except for a single line (excluded for
technical reasons), are covered by tests.</p>
</div>
<div class="section" id="usage">
<h1>Usage</h1>
<div class="section" id="installation">
<h2>Installation</h2>
<p>You can get and install <em>pymacros4py</em> as follows by using <em>pip</em>:</p>
<pre class="code shell literal-block">
pip<span class="whitespace"> </span>install<span class="whitespace"> </span>pymacros4py
</pre>
</div>
<div class="section" id="calling-pymacros4py">
<h2>Calling pymacros4py</h2>
<p>The preprocessor can be accessed in a Python script as follows:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">from</span> <span class="name namespace">pymacros4py</span> <span class="keyword namespace">import</span> <span class="name">PreProcessor</span><span class="whitespace">
</span><span class="operator">&gt;&gt;&gt;</span> <span class="name">pp</span> <span class="operator">=</span> <span class="name">PreProcessor</span><span class="punctuation">()</span>
</pre>
<p>Then, the macros in a template file can be expanded as follows:</p>
<pre class="code python literal-block">
<span class="name">pp</span><span class="operator">.</span><span class="name">expand_file_to_file</span><span class="punctuation">(</span><span class="literal string single">'my_code.template.py'</span><span class="punctuation">,</span> <span class="literal string single">'my_code.py'</span><span class="punctuation">)</span>
</pre>
<p>Warning: When <em>pymacros4py</em> expands macros, it executes the expressions, statements
and functions of your macro code. You might want to apply it only to files that you
have fully under your control. If you write macro code that includes unsafe file
content, you can disable macro expansion for this content.</p>
<p>The method <em>expand_file_to_file</em> offers the following keyword parameter:</p>
<ul class="simple">
<li><em>diff</em>: bool = False. True means that the result is not written to the
output file, but compared to the content of the file, and the result
of the comparison is printed to <em>stdout</em>.</li>
</ul>
<p>If you need specific arguments for the <em>encoding</em>, <em>errors</em>, or <em>newlines</em>
parameters used for opening files (see Python function <em>open</em>), you can set these
as attributes of the global object <em>file_options</em>:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">from</span> <span class="name namespace">pymacros4py</span> <span class="keyword namespace">import</span> <span class="name">file_options</span><span class="whitespace">
</span><span class="operator">&gt;&gt;&gt;</span> <span class="name">file_options</span><span class="operator">.</span><span class="name">encoding</span> <span class="operator">=</span> <span class="literal string double">&quot;utf-8&quot;</span>
</pre>
</div>
</div>
<div class="section" id="templates-and-template-expansion">
<h1>Templates and template expansion</h1>
<p>A <em>template</em> consists of macro sections and text sections. A single line
of a template can already contain several such sections.</p>
<ul class="simple">
<li>A macro section contains Python code intended to be executed during the macro
expansion.</li>
<li>A text section can be anything. In case of a template for a Python file,
it is normal Python code. It is used as-is (except for a possible adaptation
of the indentation).</li>
</ul>
<p>For expanding the macros in a template, <em>pymacros4py</em> separates the macro and the
text sections. Then, it generates and executes a so-called <em>template script</em>
as follows:</p>
<ul class="simple">
<li><strong>Code of macro sections of the template is directly taken into the</strong>
<strong>template script. When this code is executed, it can insert text into the output</strong>
<strong>of the macro expansion by calling function</strong> <em>insert()</em>.</li>
<li><strong>For text sections, a statement that inserts the text into the results</strong>
<strong>is automatically appended to the template script.</strong></li>
</ul>
<p><strong>Example:</strong> The following template for application code contains a full-line macro
section (the first line) and a macro section embedded in a line of the application
code</p>
<pre class="code python literal-block">
<span class="comment single"># $$ v = 2 * 3</span><span class="whitespace">
</span><span class="name">x</span> <span class="operator">=</span> <span class="literal string single">'$$ insert(v) $$'</span>
</pre>
<p>From this template, pymacros4py generates a template script that looks roughly as
follows:</p>
<pre class="code python literal-block">
<span class="name">v</span> <span class="operator">=</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number integer">3</span><span class="whitespace">
</span><span class="name">insert</span><span class="punctuation">(</span><span class="literal string single">'x = '</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">insert</span><span class="punctuation">(</span><span class="name">v</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">insert</span><span class="punctuation">(</span><span class="literal string single">'</span><span class="literal string escape">\n</span><span class="literal string single">'</span><span class="punctuation">)</span>
</pre>
<p>This template script will be executed by pymacros4py. It generates the following
application code as result:</p>
<pre class="code python literal-block">
<span class="name">x</span> <span class="operator">=</span> <span class="literal number integer">6</span>
</pre>
<p>Application code written in Python and macro code written in Python can
be mixed like this, and the macro code extends and manipulates the application code.</p>
<p>This explanation and example already gives a good impression of how templates
can be written. Further details are described in the following sections.</p>
<div class="section" id="quoted-macro-code-in-templates">
<h2>Quoted macro code in templates</h2>
<p>One way to mark macro code in a template looks similar to a
<strong>string starting and ending with two dollar characters</strong>.
Single or double quotes, or triple single or double quotes can be used.</p>
<p><strong>Example:</strong> The following lines each show a macro section with 'v = 0' as
macro code within the macro section.</p>
<pre class="code python literal-block">
<span class="literal string single">'$$ v = 0 $$'</span><span class="whitespace">
</span><span class="literal string double">&quot;$$ v = 0 $$&quot;</span><span class="whitespace">
</span><span class="literal string doc">'''$$ v = 0 $$'''</span><span class="whitespace">
</span><span class="literal string doc">&quot;&quot;&quot;$$ v = 0 $$&quot;&quot;&quot;</span>
</pre>
<p><strong>Start and end of macro code is identified only by the special combination</strong>
<strong>of quoting and dollar characters</strong>.
Thus, both the quotes and the dollars can be freely used in macro code
and in application code, as long as they do not occur together. This makes the
macro recognition quite robust.</p>
<p><strong>Example:</strong> Some dollar characters and quotes in application code and in macro
sections, but not combined in the special syntax that starts or ends a macro section</p>
<pre class="code python literal-block">
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'This is application code with $$ characters and quotes'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="literal string single">'$$ v = '</span><span class="name">This</span> <span class="operator word">is</span> <span class="name">a</span> <span class="name">quoted</span> <span class="name">string</span> <span class="name">within</span> <span class="name">macro</span> <span class="name">code</span><span class="literal string single">' $$'</span>
</pre>
<p>A <strong>macro section</strong> spans quoting, dollars and code together.</p>
<p>If before and after the quotes, there are only space or tab characters,
the macro section is a <em>block macro section</em> (otherwise: an <em>inline macro section</em>)
and spans the whole line(s), including a trailing line break if present.</p>
<p><strong>Example:</strong> Macro section that spans the whole line, including the trailing line break.</p>
<pre class="code python literal-block">
<span class="comment single"># This is a comment in application code</span><span class="whitespace">
</span><span class="literal string single">'$$ v = 0  # This macro section spans the whole line $$'</span><span class="whitespace">
</span><span class="comment single"># This is a second comment in application code</span>
</pre>
<p>Macro code can span several lines. All four possible quoting types can be used for
this, but triple quotes are more pythonic here.</p>
<p><strong>Example:</strong> Macro section that spans several lines</p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$ # This comment belongs to the macro code
      v = 'a string'
$$'''</span>
</pre>
<p>Whitespace and line breaks in the macro section before and after the macro code
are ignored.</p>
<p>Example: Identical macro code ('v = 0'), surrounded by different whitespace and/or
line breaks.</p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$      v = 0       $$'''</span><span class="whitespace">
</span><span class="literal string doc">'''$$
      v = 0
$$'''</span>
</pre>
</div>
<div class="section" id="indentation-in-macro-code">
<h2>Indentation in macro code</h2>
<p>Macro code in a macro section can be indented to an arbitrary local level, independently
of other macro sections and surrounding application code. Locally, indentation needs
to follow Python syntax. Globally, <em>pymacros4py</em> will establish a valid indentation when
combining code of several macro sections, and code generated by <em>mymacros4py</em> itself.</p>
<p><strong>The first (non-whitespace) character of the macro code</strong> in a macro section
<strong>defines the base indentation</strong> of the code. Subsequent lines of the macro code need to
be indented accordingly: equally indented (by literally the same characters, but
with each non-whitespace character replaced by a space character),
or with additional indentation characters (following the base indentation), or not
indented at all. When <em>pymacros4py</em> re-indents code, it changes only the base
indentation, and it keeps non-indented lines non-indented.</p>
<p>Note: This concept supports indentation by space characters, by tabs, and even
mixed forms, and does not require fixing the amount of indentation resulting from a tab.
But there is one limitation:
<strong>If macro code is indented by tabs, it needs to start in its own line.</strong></p>
<p><strong>Example:</strong> Macro code starts in its own line.
Indentation is done by space and/or tab characters.
The indentation of the first
non-whitespace character (here: 'v') defines the base indentation of the
macro section, and subsequent lines are indented equally (by an identical indentation
string). The third line is locally indented, relative to this base indentation.</p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$
        v1 = 0
        for i in range(3):
            v1 += i
$$'''</span>
</pre>
<p><strong>Example:</strong> Macro code starts in the first line of the macro section.
All indentation is done by space characters.
The number of characters left to the 'v' determines
the base indentation that the second line follows.
The third line is locally indented, relative to this base indentation.</p>
<pre class="code python literal-block">
<span class="literal string doc">'''$       v1 = 0
           for i in range(3):
               v1 += i
$$'''</span>
</pre>
<p><strong>Example:</strong> Multi-line string with non-indented content</p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$
    if True:  # enforce indentation
        v1 = &quot;&quot;&quot;
    First line of string. No indentation. This will be preserved.
    Second line of string. No indentation. This will be preserved.
    &quot;&quot;&quot;
        # We continue the indented suite of the if statement
        v2 = 0
$$'''</span>
</pre>
</div>
<div class="section" id="macro-code-in-a-comment">
<h2>Macro code in a comment</h2>
<p>A second option to mark macro code in a template has the <strong>form of a comment,</strong>
<strong>starting with a hash character</strong>, optionally
followed by spaces or tabs, <strong>and two dollar characters</strong>. The macro code ends with
the line. If there are only space and/or tab characters before the hash,
the macro section spans the whole line, including a trailing line break.</p>
<pre class="code python literal-block">
<span class="comment single"># $$ v = 0</span>
</pre>
</div>
<div class="section" id="arbitrary-python-code-as-macro-code">
<h2>Arbitrary Python code as macro code</h2>
<p><strong>Macro code is regular Python code</strong>. A call to the predefined
<strong>function</strong>
<em>insert</em>
<strong>inserts the results of applying the function</strong>
<em>str</em>
<strong>to the arguments of</strong>
<em>insert</em>
<strong>at the place of the macro section</strong>.</p>
<p><strong>Example:</strong> Macro code defining a function that generates code</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">a_function_of_our_application</span><span class="punctuation">():</span><span class="whitespace">
    </span><span class="literal string doc">'''$$
    # Here, we define a function in macro code
    def return_print_n_times(n, s):
        statement = f'print(&quot;{s}&quot;)\n'
        return statement * n
    # Now, we call it
    insert(return_print_n_times(3, &quot;Yep.&quot;))
    $$'''</span>
</pre>
<p>The template script derived from this template generates the following result:</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">a_function_of_our_application</span><span class="punctuation">():</span><span class="whitespace">
</span>    <span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string double">&quot;Yep.&quot;</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string double">&quot;Yep.&quot;</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string double">&quot;Yep.&quot;</span><span class="punctuation">)</span>
</pre>
<p><strong>Example:</strong> Macro code inserting a computation result</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">example_function</span><span class="punctuation">(</span><span class="name">i</span><span class="punctuation">:</span> <span class="name builtin">int</span><span class="punctuation">)</span> <span class="operator">-&gt;</span> <span class="name builtin">int</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="comment single"># $$ v = 2 * 2</span><span class="whitespace">
</span>    <span class="keyword">return</span> <span class="literal string single">'$$ insert(v) $$'</span>
</pre>
<p>It evaluates to:</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">example_function</span><span class="punctuation">(</span><span class="name">i</span><span class="punctuation">:</span> <span class="name builtin">int</span><span class="punctuation">)</span> <span class="operator">-&gt;</span> <span class="name builtin">int</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="keyword">return</span> <span class="literal number integer">4</span>
</pre>
</div>
<div class="section" id="indentation-of-macro-results">
<h2>Indentation of macro results</h2>
<p><strong>The results of the expansion of a macro section</strong>,
e.g., the output of calls of function <em>insert</em>, <strong>are indented relative to the</strong>
<strong>indentation of the first non-whitespace character of the macro section</strong> (i.e.,
the hash character for macro code in a comment, resp., the first quote in quoted
macro code).</p>
<p><strong>Example:</strong> Macro sections with different indentation levels</p>
<pre class="code python literal-block">
<span class="name">v</span> <span class="operator">=</span> <span class="keyword constant">True</span><span class="whitespace">
</span><span class="comment single"># $$ # Macro expansion result will be indented to this level</span><span class="whitespace">
</span><span class="comment single"># $$ insert(f'print({1+1})\n')</span><span class="whitespace">
</span><span class="keyword">if</span> <span class="name">v</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="comment single"># $$ # Macro expansion result will be indended to this higher level</span><span class="whitespace">
</span>    <span class="comment single"># $$ insert(f'print({2+2})\n')</span>
</pre>
<p>This template is evaluated to the following result:</p>
<pre class="code python literal-block">
<span class="name">v</span> <span class="operator">=</span> <span class="keyword constant">True</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="keyword">if</span> <span class="name">v</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="name builtin">print</span><span class="punctuation">(</span><span class="literal number integer">4</span><span class="punctuation">)</span>
</pre>
<p><strong>For inline macro sections, the first line of the results is inserted without</strong>
<strong>adding indentation.</strong> For block macro sections, each line is (re-) indented.</p>
<p><strong>Example:</strong> An inline macro section and a block macro section, both with multi-line
results</p>
<pre class="code python literal-block">
<span class="comment single"># $$ v = 2</span><span class="whitespace">
</span><span class="name">y</span> <span class="operator">=</span> <span class="literal number integer">1</span> <span class="operator">+</span> <span class="literal string single">'$$ insert(&quot;(</span><span class="literal string escape">\n</span><span class="literal string single">&quot;, v, &quot;</span><span class="literal string escape">\n</span><span class="literal string single">* w</span><span class="literal string escape">\n</span><span class="literal string single">)&quot;) $$'</span><span class="whitespace">
</span><span class="name">z</span> <span class="operator">=</span> <span class="literal number integer">11</span> <span class="operator">+</span> <span class="punctuation">(</span><span class="whitespace">
         </span><span class="literal string doc">'''$$ insert(v+1, &quot;\n*w\n&quot;) $$'''</span><span class="whitespace">
</span>         <span class="punctuation">)</span>
</pre>
<p>This template is evaluated to the following result:</p>
<pre class="code python literal-block">
<span class="name">y</span> <span class="operator">=</span> <span class="literal number integer">1</span> <span class="operator">+</span> <span class="punctuation">(</span><span class="whitespace">
</span>        <span class="literal number integer">2</span><span class="whitespace">
</span>        <span class="operator">*</span> <span class="name">w</span><span class="whitespace">
</span>        <span class="punctuation">)</span><span class="whitespace">
</span><span class="name">z</span> <span class="operator">=</span> <span class="literal number integer">11</span> <span class="operator">+</span> <span class="punctuation">(</span><span class="whitespace">
</span>         <span class="literal number integer">3</span><span class="whitespace">
</span>         <span class="operator">*</span><span class="name">w</span><span class="whitespace">
</span>         <span class="punctuation">)</span>
</pre>
<p>In the first case, the inline macro section, the expansion result (starting with the
opening bracket) is inserted directly after the application code 'y = 1 + ', without
indentation.</p>
<p>In the second case, the block macro section, the expansion result (starting with the
'3') is inserted with indentation.</p>
<p><strong>If the library detects zero indentation in macro output, this zero indentation</strong>
<strong>is preserved, i.e., no re-indentation happens.</strong></p>
<p><strong>Example:</strong> Recognizable zero indentation in macro output is preserved.</p>
<pre class="code python literal-block">
<span class="keyword">if</span> <span class="keyword constant">True</span><span class="punctuation">:</span><span class="whitespace">
    </span><span class="literal string doc">&quot;&quot;&quot;$$
        insert(&quot;    v = '''\ntext\n'''\n&quot;)
    $$&quot;&quot;&quot;</span>
</pre>
<p>This template is evaluated to the following result:</p>
<pre class="code python literal-block">
<span class="keyword">if</span> <span class="keyword constant">True</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="name">v</span> <span class="operator">=</span> <span class="literal string single">'''
text
'''</span>
</pre>
<p>The macro section of the example starts in an indented suite, here, of an <em>if</em>
statement. Thus, macro output of the following macro code will be re-indented
to this level - except for the case that zero indentation of output is explicitly
demanded. So, we can check in the results, if this exception works.</p>
<p>Then, in the macro code, we start with inserting output at a non-zero base
indentation, as reference (the spaces before the assignment). So, the library
can detect that the subsequent lines require zero-indentation (the text of
the string literal is given with zero indentation).</p>
<p>In the expansion result, we see that the macro output starts indented to the
level of the start of the macro section: re-indentation happened here. But then,
the zero indentation of the lines of the string literal is detected and thus
preserved.</p>
</div>
</div>
<div class="section" id="including-and-importing-files">
<h1>Including and importing files</h1>
<p>Macro code can access the <em>PreProcessor</em> object that executes the current macro
expansion: In the macro scope, it is available as attribute <em>pp</em>.</p>
<p>Its methods are:</p>
<ul>
<li><p class="first"><strong>insert_from(self, template_file: str, globals_dict: Optional[dict]=None) -&gt; None:</strong></p>
<p>Perform a macro expansion of <em>template_file</em> within a new namespace, and
<strong>insert the results</strong> into the results of the current macro expansion.
<em>globals</em> can be given to initialize the namespace like in a call of <em>eval()</em>.</p>
<p>When called a second time with an identical argument for <em>file</em>,
and <em>globals</em> is <em>None</em> in both calls, re-use the output of the previous run.</p>
<p>(If <em>globals</em> is not <em>None</em>, and you want to re-use results in cases of
equivalent content of <em>globals</em>, this has to be implemented manually.)</p>
</li>
<li><p class="first"><strong>import_from(self, template_file: str) -&gt; None:</strong></p>
<p>Perform a macro expansion of <em>template_file</em>
<strong>in the namespace of the current macro expansion</strong>
(attributes that have already been set can be used by macro code in
<em>template_file</em>,
and attributes set by such code can be used in macro code following
the call).</p>
<p>Discard the output of the expansion run.</p>
<p>When called a second time with an identical argument for <em>template_file</em>,
ignore the call.</p>
</li>
</ul>
<p><strong>Example for insert_from:</strong></p>
<p>The following call of <em>insert_from</em>:</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">example_function</span><span class="punctuation">()</span> <span class="operator">-&gt;</span> <span class="name builtin">int</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="comment single"># $$ i = 3</span><span class="whitespace">
</span>    <span class="comment single"># $$ insert_from(&quot;tests/data/file_with_output_macro.py&quot;)</span><span class="whitespace">
</span>    <span class="keyword">return</span> <span class="literal string double">&quot;$$ insert(i) $$&quot;</span>
</pre>
<p>with the following content of the file:</p>
<pre class="code python literal-block">
<span class="comment single"># $$ i = 2</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'some text'</span><span class="punctuation">)</span>
</pre>
<p>evaluates to:</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">example_function</span><span class="punctuation">()</span> <span class="operator">-&gt;</span> <span class="name builtin">int</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'some text'</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="keyword">return</span> <span class="literal number integer">3</span>
</pre>
<p>The output of the <em>include</em> statement is added to the results,
but the content of the global namespace (here: the value of variable <em>i</em>) is not
changed.</p>
<p><strong>Example for import_from:</strong></p>
<p>The following template:</p>
<pre class="code python literal-block">
<span class="comment single"># $$ import_from(&quot;tests/data/file_with_definition_macro.py&quot;)</span><span class="whitespace">
</span><span class="comment single"># $$ insert(return_print_n_times(3, &quot;Yep.&quot;))</span>
</pre>
<p>with the following content of the file:</p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$
    def return_print_n_times(n, s):
        statement = f'print(&quot;{s}&quot;)\n'
        return statement * n
$$'''</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string double">&quot;Text not important&quot;</span><span class="punctuation">)</span>
</pre>
<p>evaluates to:</p>
<pre class="code python literal-block">
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string double">&quot;Yep.&quot;</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string double">&quot;Yep.&quot;</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string double">&quot;Yep.&quot;</span><span class="punctuation">)</span>
</pre>
<p>The content of the global namespace is extended by function <em>return_print_n_times</em>,
but the output of the imported template is ignored.</p>
</div>
<div class="section" id="macro-statement-suites-spanning-multiple-sections">
<h1>Macro statement suites spanning multiple sections</h1>
<p>If the code in a macro section ends within a <em>suite</em> of a Python <em>compound statement</em>
(see <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html">https://docs.python.org/3/reference/compound_stmts.html</a>)
e.g., an indented block of statements after statements like <em>if</em>, <em>for</em>, or <em>def</em>,
this suite ends with the macro code:</p>
<p><strong>Example:</strong></p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$ v = 1
      if v == 0:
          insert(&quot;print('v == 0')&quot;)
$$'''</span><span class="whitespace">
</span><span class="comment single"># $$ insert(&quot;print('Always')\n&quot;)</span>
</pre>
<p>Result:</p>
<pre class="code python literal-block">
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Always'</span><span class="punctuation">)</span>
</pre>
<p><strong>But a suite can also span over subsequent template or</strong>
<strong>macro sections</strong>. This case is supported in a limited form (!) as follows:</p>
<ul>
<li><p class="first"><strong>Start of the suite: Macro section with just the introducing statement</strong></p>
<p>The header of the compound statement (its introducing statement, ending with
a colon) needs to be the only content of the macro section. Not even
a comment is allowed after the colon.</p>
<p>Reason: The beginning of a suite that is meant to span multiple sections is
recognized by the colon ending the macro code. The kind of compound statement is
recognized by the first word of the macro code.</p>
</li>
<li><p class="first"><strong>A suite is ended by a</strong> <em>:end</em> <strong>macro section</strong></p>
<p>If the code of a macro section just consists of the special statement <em>:end</em>,
the suite that has started most recently, ends. Whitespace is ignored.</p>
</li>
<li><p class="first"><strong>Macro sections</strong> <em>elif, else, except, finally,</em> <strong>and</strong> <em>case</em>
<strong>end a suite and start a new one</strong></p>
<p>If a macro section starts with one of the listed statements and ends with
a colon, the suite ends, that has started most recently, the macro code is handled,
and then a new suite starts.</p>
</li>
<li><p class="first"><strong>Such suites can be nested.</strong></p>
</li>
</ul>
<p><strong>Examples for conditionally discarding or using text sections:</strong></p>
<pre class="code python literal-block">
<span class="comment single"># $$ import datetime</span><span class="whitespace">
</span><span class="comment single"># $$ d = datetime.date.today()</span><span class="whitespace">
</span><span class="comment single"># $$ if d &gt; datetime.date(2024, 1, 1):</span><span class="whitespace">
</span><span class="comment single"># $$ code_block = 1</span><span class="whitespace">
</span><span class="comment single"># This comes from the first macro code block, number '$$ insert(code_block) $$'</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'January 1st, 2024, or later'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="comment single"># $$ else:</span><span class="whitespace">
</span><span class="comment single"># This comes from the second macro code block, number '$$ insert(code_block) $$'</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Earlier than January 1st, 2024'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="comment single"># $$ :end</span>
</pre>
<p>The template script generated from this template looks roughly as follows:</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">datetime</span><span class="whitespace">
</span><span class="name">d</span> <span class="operator">=</span> <span class="name">datetime</span><span class="operator">.</span><span class="name">date</span><span class="operator">.</span><span class="name">today</span><span class="punctuation">()</span><span class="whitespace">
</span><span class="keyword">if</span> <span class="name">d</span> <span class="operator">&gt;</span> <span class="name">datetime</span><span class="operator">.</span><span class="name">date</span><span class="punctuation">(</span><span class="literal number integer">2024</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">):</span><span class="whitespace">
</span>    <span class="name">code_block</span> <span class="operator">=</span> <span class="literal number integer">1</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="literal string single">'# This comes from the first macro code block, number '</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="name">code_block</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="literal string double">&quot;</span><span class="literal string escape">\n</span><span class="literal string double">print('January 1st, 2024, or later')</span><span class="literal string escape">\n</span><span class="literal string double">&quot;</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="keyword">else</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="literal string single">'# This comes from the second macro code block, number '</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="name">code_block</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="literal string double">&quot;</span><span class="literal string escape">\n</span><span class="literal string double">print('Earlier than January 1st, 2024')</span><span class="literal string escape">\n</span><span class="literal string double">&quot;</span><span class="punctuation">)</span>
</pre>
<p>Note that <em>pymacros4py</em> automatically indents the <em>insert</em> statements and the
statements <em>code_block = ...</em> when generating the template script, because in
Python, suites of compound statements need to be indented.</p>
<p>This template script evaluates to:</p>
<pre class="code python literal-block">
<span class="comment single"># This comes from the first macro code block, number 1</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'January 1st, 2024, or later'</span><span class="punctuation">)</span>
</pre>
<p><strong>Examples for loops over text blocks:</strong></p>
<pre class="code python literal-block">
<span class="comment single"># $$ for i in range(3):</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Yep, i is &quot;$$ insert(i) $$&quot;.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="comment single"># $$ :end</span><span class="whitespace">
</span><span class="comment single"># $$ j = 5</span><span class="whitespace">
</span><span class="comment single"># $$ while j &gt; 3:</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'And, yep, j is &quot;$$ insert(j) $$&quot;.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="comment single"># $$ j -= 1</span><span class="whitespace">
</span><span class="comment single"># $$ :end</span>
</pre>
<p>This template evaluates to:</p>
<pre class="code python literal-block">
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Yep, i is 0.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Yep, i is 1.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Yep, i is 2.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'And, yep, j is 5.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'And, yep, j is 4.'</span><span class="punctuation">)</span>
</pre>
<p><strong>Example for a multi-section suite containing</strong>
<strong>both indented and non-indented macro code:</strong></p>
<pre class="code python literal-block">
<span class="comment single"># $$ for i in range(2):</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Code from the text section, variable i is &quot;$$ insert(i) $$&quot;.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="literal string doc">'''$$ # The macro code of this section is locally indented to this level,
      # but not the content of the following text literal
      more_text = &quot;&quot;&quot;\
print('This first line is not indented.')
print('This second line is not indented.')
&quot;&quot;&quot;
      # We continue at the base indention, it is here
      insert(more_text)
$$'''</span><span class="whitespace">

</span><span class="comment single"># $$ :end</span>
</pre>
<p>The template script generated from this template looks roughly as follows:</p>
<pre class="code python literal-block">
<span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">):</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="literal string double">&quot;print('Code from the text section, variable i is &quot;</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="name">i</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="literal string double">&quot;.')</span><span class="literal string escape">\n</span><span class="literal string double">&quot;</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="comment single"># The macro code of this section is locally indented to this level,</span><span class="whitespace">
</span>    <span class="comment single"># but not the content of the following text literal</span><span class="whitespace">
</span>    <span class="name">more_text</span> <span class="operator">=</span> <span class="literal string double">&quot;&quot;&quot;</span><span class="literal string escape">\
</span><span class="literal string double">print('This first line is not indented.')
print('This second line is not indented.')
&quot;&quot;&quot;</span><span class="whitespace">
</span>    <span class="comment single"># We continue at the base indention, it is here</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="name">more_text</span><span class="punctuation">)</span><span class="whitespace">
</span>    <span class="name">insert</span><span class="punctuation">(</span><span class="literal string single">'</span><span class="literal string escape">\n</span><span class="literal string single">'</span><span class="punctuation">)</span>
</pre>
<p>This template script shows: The implementation of multi-section suites by
<em>pymacros4py</em> meets two requirements:</p>
<ul class="simple">
<li>In Python, code in suites of compound statements needs to be indented. So,
<em>pymacros4py</em> generates this indentation synthetically (re-indentation) when
generating the template script.</li>
<li>It must be possible to define unindented string literals. So, <em>pymacros4py</em>
distinguishes unindented code from indented code, re-indents only the indented
code, but uses the unindented code as-is.</li>
</ul>
<p>The template evaluates to:</p>
<pre class="code python literal-block">
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Code from the text section, variable i is 0.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'This first line is not indented.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'This second line is not indented.'</span><span class="punctuation">)</span><span class="whitespace">

</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'Code from the text section, variable i is 1.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'This first line is not indented.'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'This second line is not indented.'</span><span class="punctuation">)</span>
</pre>
</div>
<div class="section" id="def-statement-suites-spanning-multiple-sections">
<h1>def-statement-suites spanning multiple sections</h1>
<p>If the suite of a <em>def</em>-statement spans multiple sections, indentation of
generated results of the macro expansion is special-cased as follows:</p>
<ul class="simple">
<li><strong>Macro sections: Generated code is indented as part of the calling macro section</strong>,
not the defining macro section.</li>
<li><strong>Text sections: The content is also indented as part of the generated results</strong>
(whereas outside the suite of a <em>def</em> statement, it is interpreted as literal).
And the same rules apply: Zero indentation is kept, other indentation is interpreted
relative to the indentation of the first content character, and the indentation
is adapted to the indentation of the calling macro section.</li>
</ul>
<p><strong>Examples:</strong></p>
<pre class="code python literal-block">
<span class="comment single"># $$ def some_inlined_computation(times, acc):</span><span class="whitespace">
</span><span class="keyword">for</span> <span class="name">macro_var_i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="literal string single">'$$ insert(times) $$'</span><span class="punctuation">):</span><span class="whitespace">
</span>    <span class="literal string single">'$$ insert(acc) $$'</span> <span class="operator">=</span> <span class="literal number integer">1</span><span class="whitespace">
</span><span class="comment single"># $$ :end</span><span class="whitespace">
</span><span class="name">j</span> <span class="operator">=</span> <span class="name">k</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="whitespace">
</span><span class="comment single"># $$ some_inlined_computation(3, &quot;j&quot;)</span><span class="whitespace">
</span><span class="keyword">if</span> <span class="keyword constant">True</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="comment single"># $$ some_inlined_computation(2, &quot;k&quot;)</span>
</pre>
<p>This template evaluates to:</p>
<pre class="code python literal-block">
<span class="name">j</span> <span class="operator">=</span> <span class="name">k</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="whitespace">
</span><span class="keyword">for</span> <span class="name">macro_var_i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">):</span><span class="whitespace">
</span>    <span class="name">j</span> <span class="operator">=</span> <span class="literal number integer">1</span><span class="whitespace">
</span><span class="keyword">if</span> <span class="keyword constant">True</span><span class="punctuation">:</span><span class="whitespace">
</span>    <span class="keyword">for</span> <span class="name">macro_var_i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">):</span><span class="whitespace">
</span>        <span class="name">k</span> <span class="operator">=</span> <span class="literal number integer">1</span>
</pre>
<p>Note, that the indentation of the results of the two calls of the function is defined
by the indentation of the calling macro sections, and not the defining macro
section. And this holds both for the macro sections and the text sections within the
suite of the <em>def</em> statement. Like that, valid indentation is established.</p>
</div>
<div class="section" id="debugging">
<h1>Debugging</h1>
<div class="section" id="error-messages">
<h2>Error messages</h2>
<p>In case something goes wrong, <em>pymacros4py</em> tries to give helpful error messages.</p>
<p><strong>Example: Wrong indentation within macro code</strong></p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$
    # first line
  # indentation of second line below base indentation, but not zero
$$'''</span>
</pre>
<p>This template leads to the following exception:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file_to_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/error_wrong_indentation_in_macro.tpl.py&quot;</span><span class="punctuation">,</span> <span class="literal string double">&quot;out.py&quot;</span><span class="whitespace">
</span><span class="operator">...</span> <span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE</span><span class="whitespace">
</span><span class="name">Traceback</span> <span class="punctuation">(</span><span class="name">most</span> <span class="name">recent</span> <span class="name">call</span> <span class="name">last</span><span class="punctuation">):</span><span class="whitespace">
</span><span class="name exception">RuntimeError</span><span class="punctuation">:</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/error_wrong_indentation_in_macro.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">2</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="name">Syntax</span> <span class="name">error</span><span class="punctuation">:</span> <span class="name">indentation</span> <span class="name">of</span> <span class="name">line</span> <span class="literal number integer">1</span> <span class="name">of</span> <span class="name">the</span> <span class="name">macro</span> <span class="name">code</span> <span class="operator word">is</span> <span class="operator word">not</span> <span class="name">an</span><span class="whitespace">
</span><span class="name">extension</span> <span class="name">of</span> <span class="name">the</span> <span class="name">base</span> <span class="name">indentation</span><span class="operator">.</span>
</pre>
<p><strong>Example: Macro section started, but not ended</strong></p>
<pre class="code python literal-block">
<span class="literal string single">'''$$</span>
</pre>
<p>This template leads to the following exception:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file_to_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/error_macro_section_not_ended.tpl.py&quot;</span><span class="punctuation">,</span> <span class="literal string double">&quot;out.py&quot;</span><span class="whitespace">
</span><span class="operator">...</span> <span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE</span><span class="whitespace">
</span><span class="name">Traceback</span> <span class="punctuation">(</span><span class="name">most</span> <span class="name">recent</span> <span class="name">call</span> <span class="name">last</span><span class="punctuation">):</span><span class="whitespace">
</span><span class="name exception">RuntimeError</span><span class="punctuation">:</span> <span class="operator">---</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/error_macro_section_not_ended.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">1</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="name">Syntax</span> <span class="name">error</span> <span class="operator word">in</span> <span class="name">macro</span> <span class="name">section</span><span class="punctuation">,</span> <span class="name">macro</span> <span class="name">started</span> <span class="name">but</span> <span class="operator word">not</span> <span class="name">ended</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="literal string single">'''$$
&lt;BLANKLINE&gt;</span>
</pre>
<p><strong>Example: Nesting of multi-section suites of compound statements wrong,</strong>
<strong>unexpected suite end</strong></p>
<pre class="code python literal-block">
<span class="comment single">#$$ if True:</span><span class="whitespace">
</span><span class="comment single">#$$ :end</span><span class="whitespace">
</span><span class="comment single">#$$ :end</span>
</pre>
<p>This template leads to the following exception:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file_to_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/error_unexpected_end.tpl.py&quot;</span><span class="punctuation">,</span> <span class="literal string double">&quot;out.py&quot;</span><span class="whitespace">
</span><span class="operator">...</span> <span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE</span><span class="whitespace">
</span><span class="name">Traceback</span> <span class="punctuation">(</span><span class="name">most</span> <span class="name">recent</span> <span class="name">call</span> <span class="name">last</span><span class="punctuation">):</span><span class="whitespace">
</span><span class="name exception">RuntimeError</span><span class="punctuation">:</span> <span class="operator">---</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/error_unexpected_end.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">3</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="name">Nesting</span> <span class="name">error</span> <span class="operator word">in</span> <span class="name">compound</span> <span class="name">statements</span> <span class="keyword">with</span> <span class="name">suites</span> <span class="name">spanning</span> <span class="name">several</span> <span class="name">sections</span><span class="punctuation">,</span><span class="whitespace">
</span><span class="operator word">in</span> <span class="name">macro</span> <span class="name">section</span><span class="punctuation">:</span><span class="whitespace">
</span>  <span class="punctuation">:</span><span class="name">end</span>
</pre>
<p><strong>Example: Nesting of multi-section suites of compound statements wrong,</strong>
<strong>suite end missing</strong></p>
<pre class="code python literal-block">
<span class="comment single">#$$ if True:</span>
</pre>
<p>This template leads to the following exception:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file_to_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/error_end_missing.tpl.py&quot;</span><span class="punctuation">,</span> <span class="literal string double">&quot;out.py&quot;</span><span class="whitespace">
</span><span class="operator">...</span> <span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE</span><span class="whitespace">
</span><span class="name">Traceback</span> <span class="punctuation">(</span><span class="name">most</span> <span class="name">recent</span> <span class="name">call</span> <span class="name">last</span><span class="punctuation">):</span><span class="whitespace">
</span><span class="name exception">RuntimeError</span><span class="punctuation">:</span> <span class="name">Syntax</span> <span class="name">error</span><span class="punctuation">:</span> <span class="name">block</span> <span class="name">nesting</span> <span class="punctuation">(</span><span class="name">indentation</span><span class="punctuation">)</span> <span class="operator word">not</span> <span class="name">correct</span><span class="punctuation">,</span><span class="whitespace">
</span><span class="operator word">is</span> <span class="punctuation">:</span><span class="name">end</span> <span class="name">somewhere</span> <span class="name">missing</span><span class="error">?</span>
</pre>
<p><strong>Example: Wrong indentation of expansion results</strong></p>
<pre class="code python literal-block">
<span class="literal string doc">'''$$
  insert(&quot;    # First line indented\n&quot;)
  insert(&quot;  # Second line indented, but less than the first\n&quot;)
$$'''</span>
</pre>
<p>This template leads to the following exception:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file_to_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/error_result_indentation_inconsistent.tpl.py&quot;</span><span class="punctuation">,</span> <span class="literal string double">&quot;out.py&quot;</span><span class="whitespace">
</span><span class="operator">...</span> <span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE, +ELLIPSIS</span><span class="whitespace">
</span><span class="name">Traceback</span> <span class="punctuation">(</span><span class="name">most</span> <span class="name">recent</span> <span class="name">call</span> <span class="name">last</span><span class="punctuation">):</span><span class="whitespace">
</span><span class="name exception">RuntimeError</span><span class="punctuation">:</span> <span class="name">Error</span> <span class="name">when</span> <span class="name">executing</span> <span class="name">template</span> <span class="name">script</span> <span class="operator">...</span>
</pre>
<p>In this example output, the name of the template file is left out, because it
is not constant. Also omitted is the first half of the error message,
because Python doctests cannot handle sequences of exceptions (to my knowledge).
Here it is:</p>
<pre class="code python literal-block">
<span class="name exception">RuntimeError</span><span class="punctuation">:</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/error_result_indentation_inconsistent.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">2</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="name">Output</span> <span class="name">syntax</span> <span class="name">error</span><span class="punctuation">:</span> <span class="name">indentation</span> <span class="name">of</span> <span class="name">the</span> <span class="name">following</span> <span class="name">line</span> <span class="name">of</span> <span class="name">the</span> <span class="name">results</span> <span class="name">of</span><span class="whitespace">
</span><span class="name">the</span> <span class="name">template</span> <span class="name">script</span> <span class="keyword namespace">from</span> <span class="name namespace">the</span> <span class="name">above</span> <span class="name">given</span> <span class="name">template</span> <span class="name">line</span> <span class="operator word">is</span> <span class="operator word">not</span> <span class="name">an</span> <span class="name">extension</span><span class="whitespace">
</span><span class="name">of</span> <span class="name">the</span> <span class="name">base</span> <span class="name">indentation</span> <span class="name">of</span> <span class="name">these</span> <span class="name">results</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="operator">&gt;</span>  <span class="comment single"># Second line indented, but less than the first&lt;</span><span class="whitespace">
</span><span class="punctuation">(</span><span class="name">Start</span> <span class="name">of</span> <span class="name">line</span> <span class="name">shown</span> <span class="name">enclosed</span> <span class="name">by</span> <span class="name">characters</span> <span class="literal string single">'&gt;'</span> <span class="operator word">and</span> <span class="literal string single">'&lt;'</span><span class="punctuation">)</span>
</pre>
</div>
<div class="section" id="comparing-results">
<h2>Comparing results</h2>
<p>Method <em>expand_file_to_file</em> offers an option <em>diffs_to_result_file</em> that shows
the differences between the results of the macro expansion and the current content
of the result file.</p>
<p><strong>Example:</strong> Showing results of a change in a template</p>
<p>In the following template, we changed the expression with respect to the example of
section <em>Templates and template expansion</em>.</p>
<pre class="code python literal-block">
<span class="comment single"># $$ # In the following line, we changed the expression w.r.t. the example of</span><span class="whitespace">
</span><span class="comment single"># $$ # section Templates and template expansion</span><span class="whitespace">
</span><span class="comment single"># $$ v = 3 * 3</span><span class="whitespace">
</span><span class="name">x</span> <span class="operator">=</span> <span class="literal string single">'$$ insert(v) $$'</span>
</pre>
<p>Now, we compare against the result we have gotten there:</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file_to_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/diff_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">,</span><span class="whitespace">
</span><span class="operator">...</span>                        <span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.py&quot;</span><span class="punctuation">,</span><span class="whitespace">
</span><span class="operator">...</span>                        <span class="name">diffs_to_result_file</span> <span class="operator">=</span> <span class="keyword constant">True</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="operator">-</span> <span class="name">x</span> <span class="operator">=</span> <span class="literal number integer">6</span><span class="whitespace">
</span><span class="error">?</span>     <span class="operator">^</span><span class="whitespace">
</span><span class="operator">+</span> <span class="name">x</span> <span class="operator">=</span> <span class="literal number integer">9</span><span class="whitespace">
</span><span class="error">?</span>     <span class="operator">^</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span>
</pre>
</div>
<div class="section" id="viewing-the-template-script">
<h2>Viewing the template script</h2>
<p>When an exception is raised during the execution of a generated template script,
e.g., if there is an error in your Python macro code, the
script will be automatically stored (as temporary file, with the platform specific
Python mechanisms) and its path will be given in the error message.</p>
<p>Additionally, the method <em>template_script</em> of <em>pymacros4py</em> can be used to
see the generated template script anytime.</p>
<p><strong>Example:</strong> Getting the template script</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name builtin">print</span><span class="punctuation">(</span><span class="name">pp</span><span class="operator">.</span><span class="name">template_script</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="operator">...</span> <span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE</span><span class="whitespace">
</span><span class="name">_macro_starts</span><span class="punctuation">(</span><span class="name">indentation</span><span class="operator">=</span><span class="literal string single">''</span><span class="punctuation">,</span> <span class="name">embedded</span><span class="operator">=</span><span class="keyword constant">False</span><span class="punctuation">,</span><span class="whitespace">
</span>    <span class="name">content_line</span><span class="operator">=</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 1'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">v</span> <span class="operator">=</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number integer">3</span><span class="whitespace">
</span><span class="name">_macro_ends</span><span class="punctuation">(</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 1'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">insert</span><span class="punctuation">(</span><span class="literal string single">'x = '</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">_macro_starts</span><span class="punctuation">(</span><span class="name">indentation</span><span class="operator">=</span><span class="literal string single">'    '</span><span class="punctuation">,</span> <span class="name">embedded</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">,</span><span class="whitespace">
</span>    <span class="name">content_line</span><span class="operator">=</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 2'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">insert</span><span class="punctuation">(</span><span class="name">v</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">_macro_ends</span><span class="punctuation">(</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 2'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="name">insert</span><span class="punctuation">(</span><span class="literal string single">'</span><span class="literal string escape">\n</span><span class="literal string single">'</span><span class="punctuation">)</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span>
</pre>
<p>Here, we used the template from section <em>Templates and template expansion</em>.
As can be seen, the real template script looks like the one shown there, but has some
additional bookkeeping code that marks when macro code starts and ends during
the execution of the template script.</p>
</div>
<div class="section" id="tracing">
<h2>Tracing</h2>
<p><em>pymacros4py</em> can write a trace log during parsing of a template and during
execution of a template script: The options <em>trace_parsing</em> and <em>trace_evaluation</em>
of method <em>expand_file_to_file</em> activate this functionality. We demonstrate
this in the following example with method <em>expand_file</em>, which returns
the expansion result instead of storing it to a file.</p>
<p><strong>Example:</strong> Tracing of the parsing process</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">r</span> <span class="operator">=</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">,</span><span class="whitespace">
</span><span class="operator">...</span>                    <span class="name">trace_parsing</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE</span><span class="whitespace">
</span><span class="operator">---</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">1</span><span class="punctuation">:</span> <span class="name">line_block_macro</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="name">v</span> <span class="operator">=</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number integer">3</span><span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">---</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">2</span><span class="punctuation">:</span> <span class="name">text</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="name">x</span> <span class="operator">=</span> <span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">---</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">2</span><span class="punctuation">:</span> <span class="name">embedded_macro</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="name">insert</span><span class="punctuation">(</span><span class="name">v</span><span class="punctuation">)</span><span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">---</span> <span class="name">File</span> <span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">,</span> <span class="name">line</span> <span class="literal number integer">2</span><span class="punctuation">:</span> <span class="name">text</span><span class="punctuation">:</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span>
</pre>
<p><strong>Example:</strong> Tracing of the evaluation process</p>
<pre class="code python literal-block">
<span class="operator">&gt;&gt;&gt;</span> <span class="name">r</span> <span class="operator">=</span> <span class="name">pp</span><span class="operator">.</span><span class="name">expand_file</span><span class="punctuation">(</span><span class="literal string double">&quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;</span><span class="punctuation">,</span><span class="whitespace">
</span><span class="operator">...</span>                    <span class="name">trace_evaluation</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">)</span>   <span class="comment single"># doctest: +NORMALIZE_WHITESPACE</span><span class="whitespace">
</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 1'</span><span class="punctuation">:</span> <span class="name">line_block_macro</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="name">v</span> <span class="operator">=</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number integer">3</span><span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 2'</span><span class="punctuation">:</span> <span class="name">text</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="name">x</span> <span class="operator">=</span> <span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 2'</span><span class="punctuation">:</span> <span class="name">embedded_macro</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="name">insert</span><span class="punctuation">(</span><span class="name">v</span><span class="punctuation">)</span><span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="literal string single">'File &quot;tests/data/doc_templ_and_templ_exp.tpl.py&quot;, line 2'</span><span class="punctuation">:</span> <span class="name">text</span><span class="whitespace">
</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span><span class="whitespace">
</span><span class="operator">&lt;</span><span class="name">BLANKLINE</span><span class="operator">&gt;</span>
</pre>
</div>
</div>
</div>
</body>
</html>
